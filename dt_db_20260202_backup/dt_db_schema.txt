-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.actuators
(
    actuator_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    actuator_type_id uuid,
    asset_id uuid,
    CONSTRAINT actuators_pkey PRIMARY KEY (actuator_id)
);

CREATE TABLE IF NOT EXISTS public.asset
(
    asset_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    asset_name text COLLATE pg_catalog."default",
    CONSTRAINT asset_pkey PRIMARY KEY (asset_id)
);

CREATE TABLE IF NOT EXISTS public.asset_failure_type
(
    asset_failure_type_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    asset_id uuid NOT NULL,
    failure_type_id uuid NOT NULL,
    criticality integer,
    CONSTRAINT asset_failure_type_pkey PRIMARY KEY (asset_failure_type_id)
);

CREATE TABLE IF NOT EXISTS public.asset_failure_type_asset_maintenance_list
(
    asset_failure_type_asset_maintenance_list_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    asset_failure_type_id uuid NOT NULL,
    asset_maintenance_list_id uuid NOT NULL,
    default_reliability real NOT NULL,
    CONSTRAINT asset_failure_type_asset_maintenance_list_pkey PRIMARY KEY (asset_failure_type_asset_maintenance_list_id)
);

CREATE TABLE IF NOT EXISTS public.asset_maintenance_list
(
    asset_maintenance_list_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    asset_id uuid NOT NULL,
    maintenance_list_id uuid NOT NULL,
    CONSTRAINT asset_maintenance_list_pkey PRIMARY KEY (asset_maintenance_list_id)
);

CREATE TABLE IF NOT EXISTS public.eta_beta
(
    eta_beta_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    eta_value real NOT NULL,
    beta_value real NOT NULL,
    "time" timestamp with time zone NOT NULL,
    asset_failure_type_id uuid NOT NULL,
    CONSTRAINT eta_beta_pkey PRIMARY KEY (eta_beta_id, "time")
);

CREATE TABLE IF NOT EXISTS public.failure
(
    failure_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    failure_name text COLLATE pg_catalog."default" NOT NULL,
    "time" timestamp with time zone NOT NULL,
    failure_type_id uuid NOT NULL,
    source_sys_time timestamp with time zone NOT NULL,
    failure_start_time timestamp with time zone NOT NULL,
    maintenance_end_time timestamp with time zone NOT NULL,
    CONSTRAINT failure_pkey PRIMARY KEY (failure_id, "time")
);

CREATE TABLE IF NOT EXISTS public.failure_type
(
    failure_type_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    failure_type_name text COLLATE pg_catalog."default" NOT NULL,
    is_preventive boolean NOT NULL,
    CONSTRAINT failure_type_pkey PRIMARY KEY (failure_type_id)
);

CREATE TABLE IF NOT EXISTS public.gamma
(
    id uuid NOT NULL,
    "time" timestamp with time zone NOT NULL,
    gamma_value real NOT NULL,
    sensor_failure_type_id uuid NOT NULL,
    contribution real NOT NULL,
    CONSTRAINT gamma_pkey PRIMARY KEY (id, "time")
);

CREATE TABLE IF NOT EXISTS public.maintenance_list
(
    maintenance_list_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    maintenance_list_name text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT maintenance_list_pkey PRIMARY KEY (maintenance_list_id)
);

CREATE TABLE IF NOT EXISTS public.measurement_types
(
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    name text COLLATE pg_catalog."default",
    unit_id uuid,
    CONSTRAINT measurement_types_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.measurements
(
    value real,
    "time" timestamp with time zone NOT NULL,
    sensor_id uuid NOT NULL,
    CONSTRAINT measurements_pkey PRIMARY KEY ("time", sensor_id)
);

CREATE TABLE IF NOT EXISTS public.operations_maintenance_list
(
    maintenance_list_id uuid NOT NULL,
    operation_id uuid NOT NULL,
    CONSTRAINT operations_maintenance_list_pkey PRIMARY KEY (maintenance_list_id, operation_id)
);

CREATE TABLE IF NOT EXISTS public.prediction
(
    prediction_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    asset_failure_type_id uuid NOT NULL,
    predicted_reliability real NOT NULL,
    "time" timestamp with time zone NOT NULL,
    prediction_future_time timestamp with time zone NOT NULL,
    CONSTRAINT prediction_pkey PRIMARY KEY (prediction_id, "time")
);

CREATE TABLE IF NOT EXISTS public.prediction_jobs
(
    job_id uuid NOT NULL DEFAULT uuid_generate_v4(),
    request_hash character(64) COLLATE pg_catalog."default" NOT NULL,
    payload json NOT NULL,
    prediction_id uuid,
    error_message text COLLATE pg_catalog."default",
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    status jobstatus NOT NULL DEFAULT 'queued'::jobstatus,
    endpoint_type text COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT prediction_jobs_pkey PRIMARY KEY (job_id)
);

CREATE TABLE IF NOT EXISTS public.sensor_failure_type
(
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    sensor_id uuid NOT NULL,
    failure_type_id uuid NOT NULL,
    CONSTRAINT sensor_failure_type_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.sensor_types
(
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    name text COLLATE pg_catalog."default",
    max_value real,
    min_value real,
    measurement_type_id uuid NOT NULL,
    max_accuracy real,
    CONSTRAINT sensor_types_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.sensors
(
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    name text COLLATE pg_catalog."default",
    upper_threshold real,
    lower_threshold real,
    measurement_frequency real,
    type_id uuid,
    accuracy real,
    asset_id uuid,
    CONSTRAINT sensors_pkey PRIMARY KEY (id)
);


CREATE TABLE IF NOT EXISTS public.units
(
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    name text COLLATE pg_catalog."default",
    CONSTRAINT units_pkey PRIMARY KEY (id)
);

ALTER TABLE IF EXISTS public.asset_failure_type
    ADD CONSTRAINT asset_id FOREIGN KEY (asset_id)
    REFERENCES public.asset (asset_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.asset_failure_type
    ADD CONSTRAINT failure_type_id FOREIGN KEY (failure_type_id)
    REFERENCES public.failure_type (failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.asset_failure_type_asset_maintenance_list
    ADD CONSTRAINT asset_failure_type_id FOREIGN KEY (asset_failure_type_id)
    REFERENCES public.asset_failure_type (asset_failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.asset_failure_type_asset_maintenance_list
    ADD CONSTRAINT asset_maintenance_list_id FOREIGN KEY (asset_maintenance_list_id)
    REFERENCES public.asset_maintenance_list (asset_maintenance_list_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.asset_maintenance_list
    ADD CONSTRAINT asset_id FOREIGN KEY (asset_id)
    REFERENCES public.asset (asset_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.asset_maintenance_list
    ADD CONSTRAINT maintenance_list_id FOREIGN KEY (maintenance_list_id)
    REFERENCES public.maintenance_list (maintenance_list_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.eta_beta
    ADD CONSTRAINT asset_failure_type_id FOREIGN KEY (asset_failure_type_id)
    REFERENCES public.asset_failure_type (asset_failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.failure
    ADD CONSTRAINT failure_type_id FOREIGN KEY (failure_type_id)
    REFERENCES public.failure_type (failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.gamma
    ADD CONSTRAINT sensor_failure_type_id FOREIGN KEY (sensor_failure_type_id)
    REFERENCES public.sensor_failure_type (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.measurement_types
    ADD CONSTRAINT unit FOREIGN KEY (unit_id)
    REFERENCES public.units (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.measurements
    ADD CONSTRAINT sensors FOREIGN KEY (sensor_id)
    REFERENCES public.sensors (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.operations_maintenance_list
    ADD CONSTRAINT maintenance_list_id FOREIGN KEY (maintenance_list_id)
    REFERENCES public.maintenance_list (maintenance_list_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.prediction
    ADD CONSTRAINT asset_failure_type_id FOREIGN KEY (asset_failure_type_id)
    REFERENCES public.asset_failure_type (asset_failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.sensor_failure_type
    ADD CONSTRAINT failure_type_id FOREIGN KEY (failure_type_id)
    REFERENCES public.failure_type (failure_type_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.sensor_failure_type
    ADD CONSTRAINT sensor_id FOREIGN KEY (sensor_id)
    REFERENCES public.sensors (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.sensor_types
    ADD CONSTRAINT measurement_types FOREIGN KEY (measurement_type_id)
    REFERENCES public.measurement_types (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.sensors
    ADD CONSTRAINT asset_id FOREIGN KEY (asset_id)
    REFERENCES public.asset (asset_id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.sensors
    ADD CONSTRAINT sensor_type_id FOREIGN KEY (type_id)
    REFERENCES public.sensor_types (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


END;